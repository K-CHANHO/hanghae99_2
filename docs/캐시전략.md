# :pushpin: 캐시 전략 보고서

## 1. 캐시의 의미
`캐시(Cache)`는 **자주 사용되는 데이터나 연산 결과를 임시로 저장해 두는 저장소**를 의미한다.  
애플리케이션에서 데이터 조회나 연산을 반복적으로 수행할 때, 캐시를 활용하면 성능을 개선할 수 있다.

---

## 2. 캐시의 목적
- `응답 시간 단축`: DB나 외부 API 호출 없이 메모리에서 바로 데이터를 조회
- `서버 부하 감소`: 반복적인 데이터 접근을 줄여 DB 및 네트워크 트래픽 완화
- `사용자 경험 개선`: 빠른 응답으로 서비스 만족도 향상
- `비용 효율성`: 서버 자원 사용 최적화 및 운영 비용 절감

---

## 3. 캐시 활용 범위
1. **조회가 빈번한 데이터**
    - 예: 상품 목록, 공통 코드, 설정 정보
2. **데이터 변경 빈도가 낮은 경우**
    - 예: 카테고리 정보, 정적 콘텐츠, 통계 집계 결과
3. **연산 비용이 높은 결과**
    - 예: 추천 알고리즘, 통계 집계, 복잡한 쿼리 결과
4. **외부 서비스 호출 비용 절감**
    - 예: 외부 API 결과, 외부 DB 조회 결과

---

## 4. 캐시 적용 전략
| 전략 | 설명 | 적용 예시 |
|------|------|-----------|
| **Read-Through** | 요청 시 캐시에 없으면 DB에서 읽고 캐시에 저장 | 상품 상세 정보, 공통 코드 |
| **Write-Through** | DB에 저장할 때 동시에 캐시에 반영 | 설정 정보, 사용자 프로필 |
| **Write-Behind** | 캐시에 먼저 저장 후 일정 시간 간격으로 DB 반영 | 통계 집계, 로그 데이터 |
| **Cache-Aside** | 애플리케이션에서 직접 캐시 확인 후 DB 조회 | 추천 상품 리스트, 사용자 세션 |

### 4.1 캐시 만료 정책
- **TTL(Time-To-Live)**: 일정 시간 후 자동 만료
- **LRU(Least Recently Used)**: 사용 빈도가 낮은 항목 제거
- **Manual Eviction**: 데이터 변경 시 수동 제거

---

## :star: 5. 실제 적용 :star:
- `인기 상품 조회`
    - 전략: Read-Through
    - TTL: 30분
    - 이유: 집계 함수를 사용해야하므로 데이터 조회에 시간이 많이 걸릴 것으로 예상된다. 또한, 인기 상품 조회의 경우 정합성이 엄청나게 요구되는 기능은 아니기 때문에 캐시를 활용하는게 효율적이라고 판단된다. (데이터가 유실되어도 크리티컬하지 않다)

### 5-1. DB조회 vs 캐시조회
- DB 조회 시 수행시간 : `126 ms`
- 캐시 조회 시 수행시간 : `17 ms`

>INFO 4870 --- [hhplus] [    Test worker] h.b.s.d.p.f.ProductFacadeIntegrationTest : 첫번째 호출 시작 - DB 조회
>
>DEBUG 4870 --- [hhplus] [    Test worker] org.hibernate.SQL                        : select p1_0.payment_id,p1_0.order_id,p1_0.paid_at,p1_0.paid_price,p1_0.status,p1_0.user_id from payment p1_0 where p1_0.status=? and p1_0.paid_at>?
>
>DEBUG 4870 --- [hhplus] [    Test worker] org.hibernate.SQL                        : SELECT product_id FROM order_product WHERE order_id IN (?,?,?,?,?) GROUP BY product_id ORDER BY count(product_id) DESC LIMIT 5
>
>DEBUG 4870 --- [hhplus] [    Test worker] org.hibernate.SQL                        : select p1_0.product_id,p1_0.price,p1_0.product_name from product p1_0 where p1_0.product_id in (?,?,?,?,?)
>
>INFO 4870 --- [hhplus] [    Test worker] h.b.s.d.p.f.ProductFacadeIntegrationTest : 첫번째 호출 끝
>
>INFO 4870 --- [hhplus] [    Test worker] h.b.s.d.p.f.ProductFacadeIntegrationTest : DB 조회 소요시간 : 126ms
>
>INFO 4870 --- [hhplus] [    Test worker] h.b.s.d.p.f.ProductFacadeIntegrationTest : 두번째 호출 시작 - 캐시 조회
>
>INFO 4870 --- [hhplus] [    Test worker] h.b.s.d.p.f.ProductFacadeIntegrationTest : 두번째 호출 끝
>
>INFO 4870 --- [hhplus] [    Test worker] h.b.s.d.p.f.ProductFacadeIntegrationTest : 캐시 조회 소요시간 : 17ms

> DB를 직접 조회할때보다 캐시를 활용할때 속도가 더 빠른 것을 확인할 수 있으며
> 
> 수행시간이 약 `85%` 향상되었다




---

## 6. 결론
캐시는 단순히 데이터를 임시 저장하는 기능이 아닌, 애플리케이션 성능 최적화 및 사용자 경험 개선을 위한 핵심 전략이다.  
따라서 데이터 특성에 맞는 캐시 전략과 TTL 정책을 수립하고, 모니터링을 통해 지속적으로 최적화하는 것이 중요하다고 생각된다.
