# 요구사항 및 기능 분석
- - -
## 1. 잔액 충전 / 조회 API
### 요구사항
- 결제에 사용될 금액을 충전하는 API 를 작성합니다.
- 사용자 식별자 및 충전할 금액을 받아 잔액을 충전합니다.
- 사용자 식별자를 통해 해당 사용자의 잔액을 조회합니다.
### 분석
- 유저아이디와 충전금액을 받아 잔액을 충전한다.
- 충전 요청 시, 동일한 요청을 여러번 보내는 경우를 대비하여, 중복 요청에 대한 처리가 필요하다.
- 조회 요청 시, 유저아이디를 통해 해당 사용자의 잔액을 조회한다.
- - -
## 2. 상품 조회 API
### 요구사항
- 상품 정보 ( ID, 이름, 가격, 잔여수량 ) 을 조회하는 API 를 작성합니다.
- 조회시점의 상품별 잔여수량이 정확하면 좋습니다.
### 분석
- 상품ID를 받아서 상품에 대한 정보를 반환
- 상품에 대한 정보는 상품ID, 상품명, 상품가격, 상품잔여수량을 포함
- - -
## 3. 선착순 쿠폰 API
### 요구사항
- 선착순 쿠폰 발급 API 및 보유 쿠폰 목록 조회 API 를 작성합니다.
- 사용자는 선착순으로 할인 쿠폰을 발급받을 수 있습니다.
- 주문 시에 유효한 할인 쿠폰을 함께 제출하면, 전체 주문금액에 대해 할인 혜택을 부여받을 수 있습니다.
### 분석
- 쿠폰 발급은 선착순으로 진행되며, 동일한 쿠폰은 사용자 당 1장씩만 발급할 수 있다.
- 쿠폰별로 정책(할인율)이 다르다.
- 쿠폰 발급 시, 쿠폰ID, 사용자ID, 쿠폰정책(할인율) 등의 정보가 포함되어야 한다.
- 쿠폰 발급 시에는 동시성을 고려한다.
- 쿠폰 조회 시에는 사용자ID를 통해 해당 사용자의 보유 쿠폰 목록을 조회한다.
- - -
## 4. 주문 / 결제 API
### 요구사항
- 사용자 식별자와 (상품 ID, 수량) 목록을 입력받아 주문하고 결제를 수행하는 API 를 작성합니다.
- 결제는 기 충전된 잔액을 기반으로 수행하며 성공할 시 잔액을 차감해야 합니다.
- 데이터 분석을 위해 결제 성공 시에 실시간으로 주문 정보를 데이터 플랫폼에 전송해야 합니다. ( 데이터 플랫폼이 어플리케이션 `외부` 라는 가정만 지켜 작업해 주시면 됩니다 )
- > 데이터 플랫폼으로의 전송 기능은 Mock API, Fake Module 등 다양한 방법으로 접근해 봅니다.
### 분석
- 주문과 결제는 분리하는 것이 좋다. 하지만, 주문 뒤에는 결제가 반드시 필요함.
- 주문에는 주문ID, 유저, 주문상품, 주문수량, 상품금액, 주문상태 등의 정보가 포함됨.
- 주문시에는 우선 상품의 재고를 확인하고, 재고가 있는 경우에 주문을 생성. 
- 결제 시에는 쿠폰 유무를 확인하고, 할인금액이 보유 잔액을 초과하지 않는 지 확인.
- 결제 당 쿠폰은 1장만 사용 가능하다.
- 결제 성공 시 잔액 차감 및 주문 상태 업데이트. 
- 결제 성공 시 주문 정보를 외부 데이터 플랫폼으로 전송.
- - -
## 5. 기본 상위 상품 조회 API
### 요구사항
- 최근 3일간 가장 많이 팔린 상위 5개 상품 정보를 제공하는 API 를 작성합니다.
- 통계 정보를 다루기 위한 기술적 고민을 충분히 해보도록 합니다.
### 분석
- 통계 데이터 수집을 위해서, 주문 정보 및 주문 상품 정보를 저장하는 테이블이 필요.